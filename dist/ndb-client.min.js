!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("angular")):"function"==typeof define&&define.amd?define("ndb-client",["angular"],e):"object"==typeof exports?exports["ndb-client"]=e(require("angular")):t["ndb-client"]=e(t.angular)}(this,function(t){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){r(2),r(1),r(3),r(4),r(5),r(6),r(7),r(8),r(9),r(10),r(11),r(12),t.exports=r(13)},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(2),i=function(){function t(t){this.$resource=t,this._entityStore=new o.EntityStore,this.resourcesAreAvailable=!1,this.apiLocation=""}return t.prototype.setLocation=function(t){return this.resourcesAreAvailable=!1,this.apiLocation=t,this.createResource(this.apiLocation),this.refreshData()},t.prototype.refreshData=function(){var t=this;return this.resourcesAreAvailable=!1,this._entityStore.clear(),new Promise(function(e){t.dataSource.query(function(r){t.registerNewItems(r),t.resourcesAreAvailable=!0,e()})})},t.prototype.update=function(t){var e;e=this.dataSource,e.update({},t)},t.prototype.createItem=function(t){var e=this;return new Promise(function(r,n){e.dataSource.save(t).$promise.then(function(t){e.dataSource.get({id:t.id},function(t){t=e.registerNewItem(t),r(t)})})["catch"](function(t){n(t)})})},t.prototype.find=function(t){return this._entityStore.findItem(t)},t.prototype.getDisplayName=function(t,e){return void 0===e&&(e=""),"name"in t?t.name:e},t.prototype.getDisplayNameForId=function(t,e){void 0===e&&(e="");var r=this.find(t);return null==r?e:this.getDisplayName(r)},t.prototype.createCustomResourceMethods=function(){return{}},Object.defineProperty(t.prototype,"apiUrl",{get:function(){return this.apiLocation},enumerable:!0,configurable:!0}),t.prototype.mapQueriedItem=function(t){return t.createdAt=new Date(t.createdAt),t.updatedAt=new Date(t.updatedAt),t},t.prototype.registerNewItem=function(t){var e=this.mapQueriedItem(t);return this._entityStore.addItem(e),e},t.prototype.registerNewItems=function(t){var e=this;return t=t.map(function(t){return e.registerNewItem(t)})},t.prototype.where=function(t){var e=this.whereAll(t);return e.length>0?e[0]:null},t.prototype.whereAll=function(t){return this._entityStore.where(t)},t.prototype.createResource=function(t){var e=this.createCustomResourceMethods();e.update={method:"PUT",url:t+"brainareas"},this.dataSource=this.$resource(t+this.resourcePath()+"/:id",{id:"@id"},e)},t.$inject=["$resource"],t}();e.DataService=i;var u=function(t){function e(){t.apply(this,arguments)}return n(e,t),e.prototype.findWithIdNumber=function(t){var e=this.where(function(e){return e.idNumber===t});return e},e}(i);e.NumberedItemDataService=u;var c=function(t){function e(){t.apply(this,arguments)}return n(e,t),e.prototype.findWithName=function(t){var e=this.where(function(e){return e.name.toLowerCase()===t.toLowerCase()});return e},e}(i);e.NamedItemDataService=c},function(t,e){"use strict";var r=function(){function t(t){void 0===t&&(t="id"),this._store={},this._array=[],this._idKey=t}return t.prototype.clear=function(){var t=this;this._array.length=0,Object.keys(this._store).forEach(function(e){delete t._store[e]})},t.prototype.findItem=function(t){return null==t||0===t.length?null:this._store[t]},t.prototype.addItem=function(t){null==this.findObject(t)&&this.insertItem(t)},t.prototype.addItems=function(t){var e=this;t.forEach(function(t){e.addItem(t)})},t.prototype.removeItem=function(t){var e=this.findObject(t);return null!=e&&this.deleteItem(e),e},t.prototype.removeItems=function(t){var e=this;return t.map(function(t){return e.removeItem(t)})},t.prototype.where=function(t){return this._array.filter(function(e){return t(e)})},Object.defineProperty(t.prototype,"items",{get:function(){return this._array},enumerable:!0,configurable:!0}),t.prototype.findObject=function(t){return this.findItem(this.getKey(t))},t.prototype.getKey=function(t){return null==t?null:t[this._idKey]},t.prototype.insertItem=function(t){this._array.push(t),this._store[t[this._idKey]]=t},t.prototype.deleteItem=function(t){if(null!=t){var e=t[this._idKey];if(null!=e){var r=this._array.indexOf(t);r>-1&&this._array.splice(r,1),e in this._store&&delete this._store[e]}}},t}();e.EntityStore=r},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(1),i=function(){function t(){}return t}();e.BrainAreaDepthEntry=i;var u=function(t){function e(e){t.call(this,e)}return n(e,t),Object.defineProperty(e.prototype,"service",{get:function(){return this.dataSource},enumerable:!0,configurable:!0}),e.prototype.mapQueriedItem=function(t){return t.createdAt=new Date(t.createdAt),t.updatedAt=new Date(t.updatedAt),t},e.prototype.resourcePath=function(){return"brainareas"},e.prototype.createCustomResourceMethods=function(){return{queryForDepth:{method:"GET",url:this.apiUrl+"brainareas/depth/:depth",params:{depth:"@depth"},isArray:!0},queryForParent:{method:"GET",url:this.apiUrl+"brainareas/parent/:parentId",params:{parentId:"@parentId"},isArray:!0}}},e.prototype.brainAreasForDepth=function(t){var e=this;return new Promise(function(r,n){e.service.queryForDepth({depth:t}).$promise.then(function(t){t=e.registerNewItems(t),r(t)})["catch"](function(t){n(t)})})},e.prototype.brainAreasForParent=function(t){var e=this;return new Promise(function(r,n){e.service.queryForParent({parentId:t}).$promise.then(function(t){t=e.registerNewItems(t),r(t)})["catch"](function(t){n(t)})})},e.$inject=["$resource"],e}(o.NamedItemDataService);e.BrainAreaService=u},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(1),i=function(t){function e(e){t.call(this,e)}return n(e,t),e.prototype.resourcePath=function(){return"fluorophores"},Object.defineProperty(e.prototype,"fluorophores",{get:function(){return this._entityStore.items},enumerable:!0,configurable:!0}),e.$inject=["$resource"],e}(o.NamedItemDataService);e.FluorophoreService=i},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(1),i=function(t){function e(e,r,n){t.call(this,e),this.injectionVirusService=r,this.brainAreaService=n,this.injectionSampleMap={}}return n(e,t),e.prototype.resourcePath=function(){return"injections"},e.prototype.createCustomResourceMethods=function(){return{injectionsForSample:{method:"GET",url:this.apiUrl+"injections/sample/:id/",params:{id:"@id"},isArray:!0}}},e.prototype.registerNewItem=function(e){var r=t.prototype.registerNewItem.call(this,e),n=this.injectionSampleMap[r.sampleId];void 0!==n&&null!==n||(n=[],this.injectionSampleMap[r.sampleId]=n);var o=n.map(function(t,e){return t.id===r.sampleId?e:-1}).filter(function(t){return t>-1}),i=o.length>0?o[0]:-1;return i<0?n.push(r):n[i]=r,r},e.prototype.injectionsForSample=function(t){var e=this.injectionSampleMap[t];return void 0!==e&&null!==e||(e=[],this.injectionSampleMap[t]=e),e},Object.defineProperty(e.prototype,"injections",{get:function(){return this._entityStore.items},enumerable:!0,configurable:!0}),e.prototype.getDisplayName=function(t,e){return void 0===e&&(e=""),"("+this.brainAreaService.getDisplayNameForId(t.brainAreaId)+":"+this.injectionVirusService.getDisplayNameForId(t.injectionVirusId)+")"},e.$inject=["$resource","injectionVirusService","brainAreaService"],e}(o.DataService);e.InjectionService=i},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(1),i=function(t){function e(e){t.call(this,e)}return n(e,t),e.prototype.resourcePath=function(){return"viruses"},Object.defineProperty(e.prototype,"injectionViruses",{get:function(){return this._entityStore.items},enumerable:!0,configurable:!0}),e.$inject=["$resource"],e}(o.NamedItemDataService);e.InjectionVirusService=i},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(1),i=function(t){function e(e){t.call(this,e)}return n(e,t),e.prototype.resourcePath=function(){return"mousestrains"},Object.defineProperty(e.prototype,"mouseStrains",{get:function(){return this._entityStore.items},enumerable:!0,configurable:!0}),e.$inject=["$resource"],e}(o.NamedItemDataService);e.MouseStrainService=i},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(1),i=function(t){function e(e){t.call(this,e),this.neuronInjectionMap={}}return n(e,t),e.prototype.registerNewItem=function(e){var r=t.prototype.registerNewItem.call(this,e),n=this.neuronInjectionMap[r.injectionId];void 0!==n&&null!==n||(n=[],this.neuronInjectionMap[r.injectionId]=n);var o=n.map(function(t,e){return t.id===r.injectionId?e:-1}).filter(function(t){return t>-1}),i=o.length>0?o[0]:-1;return i<0?n.push(r):n[i]=r,r},e.prototype.resourcePath=function(){return"neurons"},e.prototype.neuronsForInjection=function(t){var e=this.neuronInjectionMap[t];return void 0!==e&&null!==e||(e=[],this.neuronInjectionMap[t]=e),e},Object.defineProperty(e.prototype,"neurons",{get:function(){return this._entityStore.items},enumerable:!0,configurable:!0}),e.prototype.getDisplayName=function(t,e){return void 0===e&&(e=""),null===t?"":t.tag.length>0?t.idNumber.toString()+" "+t.tag:t.idNumber.toString()},e.$inject=["$resource"],e}(o.NumberedItemDataService);e.NeuronService=i},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(1),i=function(t){function e(e){t.call(this,e)}return n(e,t),e.prototype.resourcePath=function(){return"registrationtransforms"},Object.defineProperty(e.prototype,"transforms",{get:function(){return this._entityStore.items},enumerable:!0,configurable:!0}),e.$inject=["$resource"],e}(o.NamedItemDataService);e.RegistrationTransformService=i},function(t,e,r){"use strict";function n(t,e,r){void 0===r&&(r="0");var n=t+"";return n.length>=e?n:new Array(e-n.length+1).join(r)+n}var o=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},i=r(1),u=function(t){function e(e){t.call(this,e)}return o(e,t),e.prototype.mapQueriedItem=function(e){return e=t.prototype.mapQueriedItem.call(this,e),e.sampleDate=new Date(e.sampleDate),e},e.prototype.resourcePath=function(){return"samples"},Object.defineProperty(e.prototype,"samples",{get:function(){return this._entityStore.items},enumerable:!0,configurable:!0}),e.prototype.getDisplayName=function(t,e){if(void 0===e&&(e=""),null===t||null===t.sampleDate)return"";var r=t.sampleDate.getFullYear()+"-"+n(t.sampleDate.getMonth()+1,2)+"-"+n(t.sampleDate.getDate(),2);return t.tag.length>0?t.idNumber.toString()+" "+t.tag+" ("+r+")":t.idNumber.toString()+" ("+r+")"},e.$inject=["$resource"],e}(i.NumberedItemDataService);e.SampleService=u},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(1),i=function(t){function e(e){t.call(this,e)}return n(e,t),e.prototype.resourcePath=function(){return"structures"},Object.defineProperty(e.prototype,"structures",{get:function(){return this._entityStore.items},enumerable:!0,configurable:!0}),e.$inject=["$resource"],e}(o.NamedItemDataService);e.StructureIdentifierService=i},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(1),i=function(t){function e(e){t.call(this,e)}return n(e,t),Object.defineProperty(e.prototype,"service",{get:function(){return this.dataSource},enumerable:!0,configurable:!0}),e.prototype.resourcePath=function(){return"nodes"},e.prototype.createCustomResourceMethods=function(){return{nodesForStructure:{method:"GET",url:this.apiUrl+"nodes/findByStructure/:id/",params:{id:"@id"},isArray:!0}}},Object.defineProperty(e.prototype,"nodes",{get:function(){return this._entityStore.items},enumerable:!0,configurable:!0}),e.prototype.nodesForStructure=function(t){var e=this;return new Promise(function(r,n){e.service.nodesForStructure({id:t}).$promise.then(function(t){r(t)})["catch"](function(t){n(t)})})},e.$inject=["$resource"],e}(o.DataService);e.TracingNodeService=i},function(t,e,r){"use strict";var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},o=r(14),i=r(1),u=function(t){function e(e,r){t.call(this,e),this.$http=r}return n(e,t),Object.defineProperty(e.prototype,"service",{get:function(){return this.dataSource},enumerable:!0,configurable:!0}),e.prototype.resourcePath=function(){return"tracings"},e.prototype.createCustomResourceMethods=function(){return{nodes:{method:"GET",url:location+"tracings/:id/nodes/",params:{id:"@id"},isArray:!0}}},Object.defineProperty(e.prototype,"tracings",{get:function(){return this._entityStore.items},enumerable:!0,configurable:!0}),e.prototype.uploadSwcFile=function(t,e){var r=this;return new Promise(function(n,i){var u=r.apiUrl+"upload",c=new FormData;c.append("contents",t),r.$http.post(u,c,{params:e,transformRequest:o.identity,headers:{"Content-Type":void 0}}).then(function(t){r.dataSource.get({id:t.data.id},function(t){r._entityStore.addItem(t),n(t)})})["catch"](function(t){console.log(t),i(t)})})},e.$inject=["$resource","$http"],e}(i.DataService);e.TracingService=u},function(e,r){e.exports=t}])});
//# sourceMappingURL=ndb-client.min.js.map